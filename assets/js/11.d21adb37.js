(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{184:function(t,e,n){"use strict";n.r(e);var a=n(0),s=Object(a.a)({},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"content"},[n("p",[t._v("Here's how to deploy an "),n("a",{attrs:{href:"https://angular.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Angular"),n("OutboundLink")],1),t._v(" app with "),n("a",{attrs:{href:"https://www.docker.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Docker"),n("OutboundLink")],1),t._v(", building it with "),n("a",{attrs:{href:"https://nodejs.org",target:"_blank",rel:"noopener noreferrer"}},[t._v("Node.js"),n("OutboundLink")],1),t._v(" as you would do locally, but end up with a thin and efficient "),n("a",{attrs:{href:"https://nginx.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Nginx"),n("OutboundLink")],1),t._v(" image, with just the compiled code. Ready for production.")]),t._v(" "),n("p",[t._v("To achieve that, you can use "),n("a",{attrs:{href:"https://docs.docker.com/engine/userguide/eng-image/multistage-build/",target:"_blank",rel:"noopener noreferrer"}},[t._v('Docker "multi-stage builds"'),n("OutboundLink")],1),t._v(". That will allow you to first build your Angular app inside a (possibly huge) Node JS Docker container that is later discarded in favor of a thin Nginx image with just your compiled app. And your final image will be as thin as the latest layer (Nginx).")]),t._v(" "),n("p",[t._v("Here you will also see how to use that technique but still support "),n("a",{attrs:{href:"https://github.com/angular/angular-cli",target:"_blank",rel:"noopener noreferrer"}},[t._v("Angular CLI"),n("OutboundLink")],1),t._v(" "),n("a",{attrs:{href:"https://github.com/angular/angular-cli/wiki/stories-application-environments",target:"_blank",rel:"noopener noreferrer"}},[t._v("environments / configurations"),n("OutboundLink")],1),t._v(".")]),t._v(" "),t._m(0),t._v(" "),n("p",[t._v("Also, optionally, you can run your Karma tests in Chrome Headless inside the Docker container. All the information is in the last section.")]),t._v(" "),n("p",[t._v("This could also be adapted to any compiled frontend framework like "),n("a",{attrs:{href:"https://reactjs.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("React"),n("OutboundLink")],1),t._v(". But the main tricks you need are all below.")]),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._m(4),t._v(" "),t._m(5),t._m(6),t._v(" "),t._m(7),t._m(8),t._v(" "),t._m(9),t._m(10),t._v(" "),t._m(11),t._m(12),t._v(" "),t._m(13),t._m(14),t._v(" "),t._m(15),n("ul",[n("li",[t._v("Open your browser in "),n("a",{attrs:{href:"http://localhost",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://localhost"),n("OutboundLink")],1),t._v(".")]),t._v(" "),n("li",[t._v("Test your image for the development environment (no configuration) with:")])]),t._v(" "),t._m(16),n("ul",[n("li",[t._v("Open your browser in "),n("a",{attrs:{href:"http://localhost",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://localhost"),n("OutboundLink")],1),t._v(".")]),t._v(" "),n("li",[t._v("If you are using testing and want to integrate it, read the last section.")])]),t._v(" "),t._m(17),t._v(" "),n("hr"),t._v(" "),t._m(18),t._v(" "),n("p",[t._v("When you build an Angular front-end app, you most commonly write it in "),n("a",{attrs:{href:"http://www.typescriptlang.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("TypeScript"),n("OutboundLink")],1),t._v(" and then compile it to JavaScript. But you need to have Node.js and several packages to do that.")]),t._v(" "),t._m(19),t._v(" "),n("p",[t._v("And those files are the final product that you serve to your users. Your users don't need your source TypeScript files nor any of the packages you use during development, just the compiled files.")]),t._v(" "),n("p",[t._v('So, you need to "deploy to production" only those files.')]),t._v(" "),n("p",[t._v('These are the options we have, take them as the "motivation" for what we will do next:')]),t._v(" "),t._m(20),t._v(" "),n("p",[t._v("One way to do it is to compile the app locally and add the compiled files to your Git repository. And then, when you are deploying, you just clone your repository and use those compiled files. As we are talking about Docker, you would create an image that copies and uses those compiled files. You would probably use an "),n("a",{attrs:{href:"https://hub.docker.com/_/nginx/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Nginx base image"),n("OutboundLink")],1),t._v(" for that.")]),t._v(" "),t._m(21),t._v(" "),n("p",[t._v("Also, if you forget to compile and commit everything right before deploying, you'll get an old version of the deployed app.")]),t._v(" "),t._m(22),t._v(" "),n("p",[t._v("Another way to do it would be to do not add your compiled code to your Git repository and build your app every time you are going to deploy.")]),t._v(" "),n("p",[t._v("But this would require all your deployment servers or wherever it is that you build your Docker image to have all the tooling to deploy your app. Node.js, TypeScript, all the Angular packages, all the dependencies, etc.")]),t._v(" "),n("p",[t._v("And again, if you forget to compile everything right before deploying, you'll get an old version of the app deployed.")]),t._v(" "),n("p",[t._v("But all the problems that you would have with dependencies by needing to have all the tooling in a server is what Docker is supposed to solve, right?")]),t._v(" "),t._m(23),t._v(" "),n("p",[t._v("You could build the whole app inside your Docker image, and then serve it from the same image.")]),t._v(" "),n("p",[t._v("That would imply that you would start from an "),n("a",{attrs:{href:"https://hub.docker.com/_/node/",target:"_blank",rel:"noopener noreferrer"}},[t._v("official Node.js base image"),n("OutboundLink")],1),t._v(" to compile everything and then you would have to setup a server with Node.js or install Nginx manually on top of Node.js (or something similar).")]),t._v(" "),n("p",[t._v("If you install Nginx by hand you lose the option to use the "),n("a",{attrs:{href:"https://hub.docker.com/_/nginx/",target:"_blank",rel:"noopener noreferrer"}},[t._v("official Nginx base image"),n("OutboundLink")],1),t._v(" that is already fine tuned.")]),t._v(" "),n("p",[t._v("Also, you would end up with huge images that all your deployment servers have to download (if you are concerned about size) and a complex environment, with all the Node.js / Angular packages and dependencies.")]),t._v(" "),t._m(24),t._v(" "),n("p",[t._v("You could write a complex script that builds your app in one Docker image using Node.js, then extract the compiled files, and then build a second image based on Nginx with just your compiled files.")]),t._v(" "),n("p",[t._v("We are getting close, but you would have another complex script to debug. Copying files from a Docker container and to another Docker image, etc. Not that promising...")]),t._v(" "),t._m(25),t._v(" "),n("p",[t._v("Use "),n("a",{attrs:{href:"https://docs.docker.com/engine/userguide/eng-image/multistage-build/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Docker multi-stage builds"),n("OutboundLink")],1),t._v('. With that, you can have a Node.js base image that installs, builds and compiles everything, and then, "discard" all those Node.js specific Docker image layers, and end up with a Nginx image with just your compiled code.')]),t._v(" "),n("p",[t._v("You would have an efficient Nginx server with great performance for your static final (compiled) files. You wouldn't have to add your compiled code to Git, you always get the latest compiled version of your code, you don't have to deal with dependencies outside Docker, etc.")]),t._v(" "),n("p",[t._v("That's great! Docker multi-stage builds solve several problems in one shot. And this option is what is "),n("a",{attrs:{href:"https://medium.com/@avatsaev/create-efficient-angular-docker-images-with-multi-stage-builds-907e2be3008d",target:"_blank",rel:"noopener noreferrer"}},[t._v('described in this article: "Create efficient Angular Docker images with Multi Stage Builds"'),n("OutboundLink")],1),t._v(". But...")]),t._v(" "),n("p",[t._v("When building your Angular code with "),n("a",{attrs:{href:"https://github.com/angular/angular-cli",target:"_blank",rel:"noopener noreferrer"}},[t._v("Angular CLI"),n("OutboundLink")],1),t._v(" you have the option to use "),n("a",{attrs:{href:"https://github.com/angular/angular-cli/wiki/stories-application-environments",target:"_blank",rel:"noopener noreferrer"}},[t._v('"configurations" to set the '),n("code",[t._v("environment")]),n("OutboundLink")],1),t._v(' while building the Angular app. That alows you to, for example, use a production back end API while using the "'),n("code",[t._v("production")]),t._v('" environment / configuration and use a testing back end API while using the unmodified configuration (development environment).')]),t._v(" "),n("p",[t._v("But with just the method described above we would have no way to use that feature.")]),t._v(" "),n("hr"),t._v(" "),t._m(26),t._v(" "),t._m(27),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://github.com/angular/angular-cli",target:"_blank",rel:"noopener noreferrer"}},[t._v("Angular CLI"),n("OutboundLink")],1),t._v(" (you need to have "),n("a",{attrs:{href:"https://nodejs.org",target:"_blank",rel:"noopener noreferrer"}},[t._v("Node.js"),n("OutboundLink")],1),t._v(" first)")]),t._v(" "),n("li",[n("a",{attrs:{href:"https://www.docker.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Docker"),n("OutboundLink")],1)])]),t._v(" "),t._m(28),t._v(" "),n("p",[t._v("If you don't know Angular (Angular 2+) yet, go and do "),n("a",{attrs:{href:"https://angular.io/docs",target:"_blank",rel:"noopener noreferrer"}},[t._v("their tutorials"),n("OutboundLink")],1),t._v(" first.")]),t._v(" "),n("p",[t._v("If you are building an Angular front-end web app, you probably should create your code with "),n("a",{attrs:{href:"https://github.com/angular/angular-cli",target:"_blank",rel:"noopener noreferrer"}},[t._v("Angular CLI"),n("OutboundLink")],1),t._v(".")]),t._v(" "),n("p",[t._v("That will help you setting everything up, compiling the app with AOT (Ahead Of Time compilation), serving the app during development with automatic live-reload, etc.")]),t._v(" "),n("ul",[n("li",[t._v("So, go ahead and install "),n("a",{attrs:{href:"https://github.com/angular/angular-cli",target:"_blank",rel:"noopener noreferrer"}},[t._v("Angular CLI"),n("OutboundLink")],1),t._v(".")]),t._v(" "),n("li",[t._v('To create a new Angular project, e.g. "my-angular-project", run:')])]),t._v(" "),t._m(29),t._m(30),t._v(" "),t._m(31),t._m(32),t._v(" "),t._m(33),t._m(34),t._v(" "),t._m(35),t._m(36),t._v(" "),t._m(37),t._m(38),t._v(" "),t._m(39),t._m(40),t._v(" "),t._m(41),t._m(42),t._v(" "),t._m(43),t._v(" "),t._m(44),n("ul",[n("li",[t._v("And open your browser in "),n("a",{attrs:{href:"http://localhost:4200",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://localhost:4200"),n("OutboundLink")],1)])]),t._v(" "),n("p",[t._v("...you will see your code using the default development environment (no configuration). So you might probably see something like:")]),t._v(" "),n("img",{attrs:{src:"https://github.com/tiangolo/medium-posts/raw/master/angular-in-docker/readme-assets/01.png"}}),t._v(" "),t._m(45),t._v(" "),t._m(46),n("ul",[n("li",[t._v("And open your browser in "),n("a",{attrs:{href:"http://localhost:4200",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://localhost:4200"),n("OutboundLink")],1)])]),t._v(" "),n("p",[t._v("...you will probably see something like:")]),t._v(" "),n("img",{attrs:{src:"https://github.com/tiangolo/medium-posts/raw/master/angular-in-docker/readme-assets/02.png"}}),t._v(" "),t._m(47),t._v(" "),n("ul",[n("li",[t._v("To learn more about Angular CLI environments and configurations, check "),n("a",{attrs:{href:"https://github.com/angular/angular-cli/wiki/stories-application-environments",target:"_blank",rel:"noopener noreferrer"}},[t._v("the official Angular CLI documentation"),n("OutboundLink")],1),t._v(".")])]),t._v(" "),n("p",[t._v("This is a bare-bones Angular project. Just the basic parts to show the point. There are many ways to improve Angular using modules, etc. But we'll just stick to the basics for now.")]),t._v(" "),t._m(48),t._v(" "),n("p",[t._v('Nowadays, Nginx is more or less the "de facto standard" for static content serving. You can search about it and read about its performance. The web is full of articles about it.')]),t._v(" "),n("p",[t._v("So, for our final Docker image, we will need to have a Nginx configuration. You don't really need to know much more about it for now. As the official Docker image will do all the heavy lifting for you.")]),t._v(" "),t._m(49),t._v(" "),t._m(50),t._v(" "),n("hr"),t._v(" "),t._m(51),t._v(" "),n("p",[t._v("If you want to build your image based on Node.js directly, you need to create an Nginx config file.")]),t._v(" "),t._m(52),t._v(" "),t._m(53),t._m(54),t._v(" "),t._m(55),t._m(56),t._v(" "),t._m(57),t._v(" "),t._m(58),t._v(" "),t._m(59),t._v(" "),n("p",[t._v("Save that file, we will use it soon.")]),t._v(" "),n("p",[t._v("This is the minimum Nginx configuration. You could finetune it more, depending on your case. If you want to explore more, read the "),n("a",{attrs:{href:"http://nginx.org/en/docs/beginners_guide.html#conf_structure",target:"_blank",rel:"noopener noreferrer"}},[t._v("Nginx Beginner's Guide"),n("OutboundLink")],1),t._v(".")]),t._v(" "),t._m(60),t._v(" "),n("hr"),t._v(" "),t._m(61),t._v(" "),n("p",[t._v("If you don't know Docker yet, and you do at least some back-end stuff (deploying a front-end app counts), it might change your developer life. So, go ahead, "),n("a",{attrs:{href:"https://docs.docker.com/engine/installation/",target:"_blank",rel:"noopener noreferrer"}},[t._v("install Docker"),n("OutboundLink")],1),t._v(" and follow the "),n("a",{attrs:{href:"https://docs.docker.com/get-started/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Get Started guide"),n("OutboundLink")],1),t._v(".")]),t._v(" "),n("p",[t._v("Now, let's assume you already know enough Docker to use it. Let's go to our details.")]),t._v(" "),n("p",[t._v("Here, we'll see how we can use Docker multi-stage builds "),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/builder/#arg",target:"_blank",rel:"noopener noreferrer"}},[t._v("Docker build-time "),n("code",[t._v("ARG")]),t._v("s"),n("OutboundLink")],1),t._v(". That will allow us to pass build-time variables during image creation. And with that, we'll be able to build different images for the different Angular CLI environments, by just passing an argument to "),n("code",[t._v("docker")]),t._v(". But we need to do a couple things first.")]),t._v(" "),t._m(62),t._v(" "),t._m(63),t._v(" "),t._m(64),t._v(" "),t._m(65),n("p",[t._v("Now, let's build our Docker image.")]),t._v(" "),t._m(66),t._v(" "),t._m(67),n("p",[t._v("...now, let's check what all that is doing.")]),t._v(" "),n("ul",[n("li",[t._v("This will tell Docker that we will start with a base image "),n("a",{attrs:{href:"https://hub.docker.com/r/tiangolo/node-frontend/",target:"_blank",rel:"noopener noreferrer"}},[t._v("tiangolo/node-frontend"),n("OutboundLink")],1),t._v(" which in turn is based on the "),n("a",{attrs:{href:"https://hub.docker.com/_/node/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Node.js official image"),n("OutboundLink")],1),t._v(", notice that you won't have to install and configure Node.js inside the Linux container or anything, Docker does that for you:")])]),t._v(" "),t._m(68),t._m(69),t._v(" "),t._m(70),t._v(" "),t._m(71),t._m(72),t._v(" "),t._m(73),t._m(74),t._v(" "),t._m(75),t._m(76),t._v(" "),t._m(77),t._m(78),t._v(" "),t._m(79),n("ul",[n("li",[t._v("Inside our container we don't have a global Angular CLI installation, so we cannot just use "),n("code",[t._v("ng build")]),t._v(", because it won't find "),n("code",[t._v("ng")]),t._v(". But as Angular CLI creates an NPM script that builds everything, we can just use it, with "),n("code",[t._v("npm run build")]),t._v(". But we need to pass parameters to "),n("code",[t._v("ng")]),t._v(" and we cannot pass them directly because "),n("code",[t._v("npm")]),t._v(" would try to interpret them. So first we add "),n("code",[t._v("--")]),t._v(" to let "),n("code",[t._v("npm")]),t._v(" know that the next parameters are not for him, but for "),n("code",[t._v("ng")]),t._v(". Then, we pass the "),n("code",[t._v("--prod")]),t._v(" parameter, the equivalent of "),n("code",[t._v("--configuration=production")]),t._v(", that "),n("a",{attrs:{href:"https://github.com/angular/angular-cli/wiki/stories-application-environments",target:"_blank",rel:"noopener noreferrer"}},[t._v("sets several things at once"),n("OutboundLink")],1),t._v(". That will take care of optimizing everything for production. And lastly, we pass the "),n("code",[t._v("--configuration $configuration")]),t._v(' parameter. See that we are using the "configuration variable" '),n("code",[t._v("$configuration")]),t._v(' that we created right above. This environment variable won\'t persist after building (as an environment variable), but we can use it to pass parameters to Docker at "build time".')])]),t._v(" "),t._m(80),t._m(81),t._v(" "),n("ul",[n("li",[t._v("In the same "),n("code",[t._v("Dockerfile")]),t._v(' file, we start another section (another "stage"), like if 2 '),n("code",[t._v("Dockerfile")]),t._v("s were concatenated. That's Docker multi-stage building. It almost just looks like concatenating "),n("code",[t._v("Dockerfile")]),t._v("s. So, let's start with an "),n("a",{attrs:{href:"https://hub.docker.com/_/nginx/",target:"_blank",rel:"noopener noreferrer"}},[t._v("official Nginx base image"),n("OutboundLink")],1),t._v(' for this "stage":')])]),t._v(" "),t._m(82),n("p",[t._v("...if you were very concerned about disk space (and you didn't have any other image that probably shares the same base layers), or if, for some reason, you are a fan of Alpine Linux, you could change that line and use an "),n("a",{attrs:{href:"https://hub.docker.com/_/nginx/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Alpine version"),n("OutboundLink")],1),t._v(".")]),t._v(" "),t._m(83),t._v(" "),t._m(84),t._m(85),t._v(" "),t._m(86),t._m(87),t._v(" "),n("hr"),t._v(" "),t._m(88),t._v(" "),t._m(89),t._v(" "),t._m(90),n("p",[t._v("to:")]),t._v(" "),t._m(91),t._m(92),t._v(" "),t._m(93),t._v(" "),n("hr"),t._v(" "),t._m(94),t._v(" "),n("p",[t._v("Now we can build our image, doing it will compile everything and create a Nginx image ready for serving our app.")]),t._v(" "),t._m(95),t._v(" "),t._m(96),t._v(" "),t._m(97),t._m(98),t._v(" "),t._m(99),t._v(" "),t._m(100),t._m(101),t._v(" "),t._m(102),t._m(103),t._v(" "),t._m(104),t._v(" "),n("p",[t._v("To check that your new Docker images are working, you can start a container based on them and see the results.")]),t._v(" "),t._m(105),t._v(" "),t._m(106),n("p",[t._v("...you won't see any logs, just your terminal hanging there.")]),t._v(" "),n("ul",[n("li",[t._v("Open your browser in "),n("a",{attrs:{href:"http://localhost",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://localhost"),n("OutboundLink")],1),t._v(".")])]),t._v(" "),n("p",[t._v("You should see something very similar to:")]),t._v(" "),n("img",{attrs:{src:"https://github.com/tiangolo/medium-posts/raw/master/angular-in-docker/readme-assets/04.png"}}),t._v(" "),t._m(107),t._v(" "),t._m(108),t._v(" "),t._m(109),n("ul",[n("li",[t._v("Open your browser in "),n("a",{attrs:{href:"http://localhost",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://localhost"),n("OutboundLink")],1),t._v(".")])]),t._v(" "),n("p",[t._v("You should see something very similar to:")]),t._v(" "),n("img",{attrs:{src:"https://github.com/tiangolo/medium-posts/raw/master/angular-in-docker/readme-assets/03.png"}}),t._v(" "),t._m(110),t._v(" "),t._m(111),t._v(" "),n("p",[t._v("If you are using testing with "),n("a",{attrs:{href:"https://jasmine.github.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Jasmine"),n("OutboundLink")],1),t._v(" and "),n("a",{attrs:{href:"https://karma-runner.github.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Karma"),n("OutboundLink")],1),t._v(", you can run your tests using Chrome headless and integrate that in your "),n("code",[t._v("Dockerfile")]),t._v(".")]),t._v(" "),n("p",[t._v("That will allow it to run in a Docker container, and you will be able to test your application before building it and integrate it with CI systems (e.g. GitLab CI).")]),t._v(" "),n("p",[t._v("First, you need to add "),n("a",{attrs:{href:"https://github.com/GoogleChrome/puppeteer",target:"_blank",rel:"noopener noreferrer"}},[t._v("Puppeteer"),n("OutboundLink")],1),t._v(" as a dependency following "),n("a",{attrs:{href:"https://github.com/karma-runner/karma-chrome-launcher#headless-chromium-with-puppeteer",target:"_blank",rel:"noopener noreferrer"}},[t._v("Karma’s official documentation"),n("OutboundLink")],1),t._v(":")]),t._v(" "),t._m(112),t._v(" "),t._m(113),t._m(114),t._v(" "),t._m(115),t._m(116),t._v(" "),t._m(117),t._m(118),t._v(" "),t._m(119),n("p",[t._v("replace that line with:")]),t._v(" "),t._m(120),t._m(121),t._v(" "),t._m(122),t._m(123),t._v(" "),t._m(124),n("p",[t._v("You can try and run that. It will run the tests in your local browser. And that's how you should test it during development.")]),t._v(" "),t._m(125),t._v(" "),t._m(126),t._v(" "),t._m(127),n("p",[t._v("It should show that the tests are run in the console, and that they are passing (or not), but most importantly, it shouldn't open a Chrome browser window, as it will be running in Chrome headless mode.")]),t._v(" "),n("p",[t._v("The image "),n("a",{attrs:{href:"https://hub.docker.com/r/tiangolo/node-frontend/",target:"_blank",rel:"noopener noreferrer"}},[t._v("tiangolo/node-frontend"),n("OutboundLink")],1),t._v(" already includes all the dependencies for Puppeteer, which is what is used to run your tests in Chrome Headless. So you don't have to add anything to your "),n("code",[t._v("Dockerfile")]),t._v(" appart from running your tests.")]),t._v(" "),n("hr"),t._v(" "),t._m(128),t._v(" "),t._m(129),t._v(" "),n("p",[t._v("Right below the line:")]),t._v(" "),t._m(130),n("p",[t._v("...add the installation of "),n("a",{attrs:{href:"https://github.com/GoogleChrome/puppeteer/blob/master/docs/troubleshooting.md#running-puppeteer-in-docker",target:"_blank",rel:"noopener noreferrer"}},[t._v("Puppeteer's dependencies"),n("OutboundLink")],1),t._v(", the start of your "),n("code",[t._v("Dockerfile")]),t._v(" should contain:")]),t._v(" "),t._m(131),t._m(132),t._v(" "),n("hr"),t._v(" "),t._m(133),t._v(" "),t._m(134),n("p",[t._v("...add")]),t._v(" "),t._m(135),n("p",[t._v("...that command will run the tests in headless mode, at build time. So, you can now integrate that with your CI systems and have your frontend tested every time the image is built. If a test fails, the build fails. So if you set up continuous integration and deployment (automatic deployments), you can be safe knowing that you won't deploy code with broken tests.")]),t._v(" "),t._m(136),t._v(" "),t._m(137),n("hr"),t._v(" "),t._m(138),t._v(" "),t._m(139),t._v(" "),t._m(140),t._m(141),t._v(" "),n("hr"),t._v(" "),t._m(142),t._v(" "),t._m(143),n("br"),t._v(" "),n("div",{staticClass:"tip custom-block"},[n("p",{staticClass:"custom-block-title"},[t._v("BASED ON")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://medium.com/@tiangolo/angular-in-docker-with-nginx-supporting-environments-built-with-multi-stage-docker-builds-bb9f1724e984",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("Angular in Docker with Nginx, supporting configurations / environments, built with multi-stage Docker builds and testing with Chrome Headless")]),n("OutboundLink")],1),t._v(" article from Sebastián Ramírez on Medium")])])])},[function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("All this removes the need for complex building scripts or the need to add your built app to git (your "),e("code",[this._v("dist")]),this._v(" directory).")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"tl-dr"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#tl-dr","aria-hidden":"true"}},[this._v("#")]),this._v(" TL;DR:")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v('Create a new Angular project, e.g. "my-angular-project":')])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("ng new my-angular-project\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("Enter into your project directory:")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{attrs:{class:"token function"}},[this._v("cd")]),this._v(" my-angular-project\n")])])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ul",[n("li",[t._v("While developing, use "),n("code",[t._v("ng serve")]),t._v(' as you normally would, to be able to use live-reload and other features. But for production deployment with Docker, and to test the "production deployment" locally, do the following.')]),t._v(" "),n("li",[t._v("Add a "),n("code",[t._v(".dockerignore")]),t._v(" for "),n("code",[t._v("node_modules")]),t._v(" with:")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("node_modules\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("Add a "),e("code",[this._v("Dockerfile")]),this._v(" to your directory with:")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-Dockerfile extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('# Stage 0, "build-stage", based on Node.js, to build and compile the frontend\nFROM tiangolo/node-frontend:10 as build-stage\n\nWORKDIR /app\n\nCOPY package*.json /app/\n\nRUN npm install\n\nCOPY ./ /app/\n\nARG configuration=production\n\nRUN npm run build -- --output-path=./dist/out --configuration $configuration\n\n\n# Stage 1, based on Nginx, to have only the compiled app, ready for production with Nginx\nFROM nginx:1.15\n\nCOPY --from=build-stage /app/dist/out/ /usr/share/nginx/html\n\n# Copy the default nginx.conf provided by tiangolo/node-frontend\nCOPY --from=build-stage /nginx.conf /etc/nginx/conf.d/default.conf\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("Build your image using the production configuration (the default), e.g.:")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("docker build -t my-angular-project:prod "),e("span",{attrs:{class:"token keyword"}},[this._v(".")]),this._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("Build your image using the development environment (no configuration), e.g.:")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("docker build -t my-angular-project:dev --build-arg configuration"),e("span",{attrs:{class:"token operator"}},[this._v("=")]),e("span",{attrs:{class:"token string"}},[this._v('""')]),this._v(" "),e("span",{attrs:{class:"token keyword"}},[this._v(".")]),this._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("Test your image for the production environment (production configuration) with:")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("docker run -p 80:80 my-angular-project:prod\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("docker run -p 80:80 my-angular-project:dev\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("em",[this._v("Everything above shows the actual code you need. If you're in a hurry, you could probably just copy all that. If you want to know all the details, continue reading...")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"docker-image-in-detail"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker-image-in-detail","aria-hidden":"true"}},[this._v("#")]),this._v(" Docker Image in detail")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("After you compile your app, you end up with a set of files, normally in a directory with the name of your app inside a  "),e("code",[this._v("./dist")]),this._v(" directory. Those are the compiled files that you actually use to serve your app. And those files have all the optimizations that you use, for example, AOT (Ahead Of Time compilation).")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"option-1"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#option-1","aria-hidden":"true"}},[this._v("#")]),this._v(" Option 1:")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("But you never edit those compiled files directly, they are generated from your source files. They are constantly changing, so your Git repository will grow large just because you are adding compiled code. And if someone in your team works on a feature branch and has one version of those files and he wants to merge the feature to your main branch (probably "),e("code",[this._v("master")]),this._v("), you might have lots conflicts in those files, even when the source code doesn't have conflicts. So you would have to be fixing \"virtual\" conflicts. There are probably other disadvantages too. So, the compiled files don't really belong in your Git repository.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"option-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#option-2","aria-hidden":"true"}},[this._v("#")]),this._v(" Option 2:")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"option-3"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#option-3","aria-hidden":"true"}},[this._v("#")]),this._v(" Option 3:")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"option-4"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#option-4","aria-hidden":"true"}},[this._v("#")]),this._v(" Option 4:")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"option-5"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#option-5","aria-hidden":"true"}},[this._v("#")]),this._v(" Option 5:")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("So, let's create an "),e("strong",[this._v("Option 6")]),this._v(" that combines all of the above and lets us use Angular CLI configurations / environments.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"requirements"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#requirements","aria-hidden":"true"}},[this._v("#")]),this._v(" Requirements")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"angular"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#angular","aria-hidden":"true"}},[this._v("#")]),this._v(" Angular")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("ng new my-angular-project\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("Enter into your project directory:")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{attrs:{class:"token function"}},[this._v("cd")]),this._v(" my-angular-project\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("To be able to see the differences between the Angular CLI environments in the final app, edit your component code in "),e("code",[this._v("src/app/app.component.ts")]),this._v(", import the "),e("code",[this._v("environment")]),this._v(":")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"language-TypeScript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-typescript"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" environment "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'../environments/environment'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("Then, add that environment's "),e("code",[this._v("production")]),this._v(" property as a component property, so that you can use it in your template:")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"language-TypeScript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-typescript"}},[n("code",[n("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("AppComponent")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n"),n("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("\n\n  production "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" environment"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("production"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("Your final code might look like:")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"language-TypeScript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-typescript"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Component "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'@angular/core'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" environment "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'../environments/environment'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n@"),n("span",{attrs:{class:"token function"}},[t._v("Component")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  selector"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'app-root'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  templateUrl"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'./app.component.html'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  styleUrls"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{attrs:{class:"token string"}},[t._v("'./app.component.css'")]),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("AppComponent")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  title "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'app'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  production "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" environment"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("production"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("Then, edit your template to show your "),e("code",[this._v("production")]),this._v(" value, for example, add the following:")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"language-html extra-class"},[n("pre",{pre:!0,attrs:{class:"language-html"}},[n("code",[t._v("...\n\n"),n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("h2")]),t._v(" "),n("span",{attrs:{class:"token attr-name"}},[t._v("*ngIf")]),n("span",{attrs:{class:"token attr-value"}},[n("span",{attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{attrs:{class:"token punctuation"}},[t._v('"')]),t._v("production"),n("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("We are running in production!"),n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("h2")]),n("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("h2")]),t._v(" "),n("span",{attrs:{class:"token attr-name"}},[t._v("*ngIf")]),n("span",{attrs:{class:"token attr-value"}},[n("span",{attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{attrs:{class:"token punctuation"}},[t._v('"')]),t._v("!production"),n("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("We are running in development..."),n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("h2")]),n("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n...\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("Your final template might look like:")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"language-html extra-class"},[n("pre",{pre:!0,attrs:{class:"language-html"}},[n("code",[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),n("span",{attrs:{class:"token style-attr language-css"}},[n("span",{attrs:{class:"token attr-name"}},[t._v(" "),n("span",{attrs:{class:"token attr-name"}},[t._v("style")])]),n("span",{attrs:{class:"token punctuation"}},[t._v('="')]),n("span",{attrs:{class:"token attr-value"}},[n("span",{attrs:{class:"token property"}},[t._v("text-align")]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("center")]),n("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("h1")]),n("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\nWelcome to {{title}}!\n  "),n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("h1")]),n("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("h2")]),t._v(" "),n("span",{attrs:{class:"token attr-name"}},[t._v("*ngIf")]),n("span",{attrs:{class:"token attr-value"}},[n("span",{attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{attrs:{class:"token punctuation"}},[t._v('"')]),t._v("production"),n("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("We are running in production!"),n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("h2")]),n("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("h2")]),t._v(" "),n("span",{attrs:{class:"token attr-name"}},[t._v("*ngIf")]),n("span",{attrs:{class:"token attr-value"}},[n("span",{attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{attrs:{class:"token punctuation"}},[t._v('"')]),t._v("!production"),n("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("We are running in development..."),n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("h2")]),n("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),n("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("Note")]),this._v(": I'm omitting some of the default Angular CLI code for brevity.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("Now, if you run your code locally with the defaults, e.g.:")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("ng serve\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("But if you run it passing the "),e("code",[this._v("--prod")]),this._v(" flag (or the more specific "),e("code",[this._v("--configuration=production")]),this._v("), e.g.:")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("ng serve --prod\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("em",[this._v('notice the "'),e("code",[this._v("running in production!")]),this._v('"')]),this._v(".")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"nginx"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#nginx","aria-hidden":"true"}},[this._v("#")]),this._v(" Nginx")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"update"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#update","aria-hidden":"true"}},[this._v("#")]),this._v(" Update:")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("This article is now based on the image "),e("code",[this._v("tiangolo/node-frontend")]),this._v(" and it already provides a default Nginx configuration, you just have to copy it in the last stage (don't worry, I'll cover it below). That configuration file makes sure that all the routes go to "),e("code",[this._v("index.html")]),this._v(", so that you can use your frontend router and it will work even if your users type the URL directly in the browser. If you don't want to use that image but build it form scratch based on "),e("code",[this._v("node")]),this._v(", do the following steps.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("Optional read")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("Add a Nginx configuration inside your project directory, named "),e("code",[this._v("nginx-custom.conf")]),this._v(", with:")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"language-nginx extra-class"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("server")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("listen")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("80")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("location")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("root")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),n("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("share"),n("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),n("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("html"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("index")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("index")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html "),n("span",{attrs:{class:"token keyword"}},[t._v("index")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("htm"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("try_files")]),t._v(" "),n("span",{attrs:{class:"token variable"}},[t._v("$uri")]),t._v(" "),n("span",{attrs:{class:"token variable"}},[t._v("$uri")]),n("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("/")]),n("span",{attrs:{class:"token keyword"}},[t._v("index")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),n("span",{attrs:{class:"token number"}},[t._v("404")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("The most important part is the:")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"language-nginx extra-class"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("try_files")]),t._v(" "),n("span",{attrs:{class:"token variable"}},[t._v("$uri")]),t._v(" "),n("span",{attrs:{class:"token variable"}},[t._v("$uri")]),n("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("/")]),n("span",{attrs:{class:"token keyword"}},[t._v("index")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),n("span",{attrs:{class:"token number"}},[t._v("404")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("...that tells Nginx to try to match the files it is requested in the URL (URI) with files it has available. That will make it, for example, match the "),e("code",[this._v("/main.bundle.js")]),this._v(" and return the JavaScript file. But when there's no match, it will default to "),e("code",[this._v("index.html")]),this._v(".")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("That will make it return the "),e("code",[this._v("index.html")]),this._v(" for any other URL it receives, so, all the Angular router URLs will work, even when going to the URL directly in the browser (not being redirected from an internal section of the app).")])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[t._v("Without that, if you had a route like "),n("code",[t._v("/app/dashbaord/main")]),t._v(", when you tried to open that URL, Nginx wouldn't find the file "),n("code",[t._v("app/dashboard/main")]),t._v(" and would return a "),n("code",[t._v("404 Not found")]),t._v(", instead of returning the "),n("code",[t._v("index.html")]),t._v(" and letting the Angular router handle it.")])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[t._v("The last part, "),n("code",[t._v("=404")]),t._v(" tells Nginx to return a "),n("code",[t._v("404")]),t._v(" if it doesn't even find an "),n("code",[t._v("index.html")]),t._v(" file. That's the default case. But you will normally always have an "),n("code",[t._v("index.html")]),t._v(" file.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("End optional read")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"docker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker","aria-hidden":"true"}},[this._v("#")]),this._v(" Docker")])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[t._v('When you build your image, Docker normally "sends" all the files in the directory to the component of Docker that builds the image. If you have a '),n("code",[t._v("node_modules")]),t._v(" directory, it will take some time sending that as "),n("code",[t._v("node_modules")]),t._v(" directories tend to be huge and with lots of files. But you don't need "),n("code",[t._v("node_modules")]),t._v(" to be copied to your Docker image, you will install everything inside and create a "),n("code",[t._v("node_modules")]),t._v(" inside your container, so, sending all your "),n("code",[t._v("node_modules")]),t._v(" is a waste of time.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("The same way that you would add "),e("code",[this._v("node_modules")]),this._v(" to your "),e("code",[this._v(".gitignore")]),this._v(" file, you can use a "),e("code",[this._v(".dockerignore")]),this._v(' file to tell Docker that it shouldn\'t "send" that directory.')])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("Add a "),e("code",[this._v(".dockerignore")]),this._v(" for "),e("code",[this._v("node_modules")]),this._v(" with:")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("node_modules\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("Add a file specifically named "),e("code",[this._v("Dockerfile")]),this._v(" in your directory, with:")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-Dockerfile extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('# Stage 0, "build-stage", based on Node.js, to build and compile Angular\nFROM tiangolo/node-frontend:10 as build-stage\n\nWORKDIR /app\n\nCOPY package*.json /app/\n\nRUN npm install\n\nCOPY ./ /app/\n\nARG configuration=production\n\nRUN npm run build -- --output-path=./dist/out --configuration $configuration\n\n\n# Stage 1, based on Nginx, to have only the compiled app, ready for production with Nginx\nFROM nginx:1.15\n\nCOPY --from=build-stage /app/dist/out/ /usr/share/nginx/html\n\nCOPY --from=build-stage /nginx.conf /etc/nginx/conf.d/default.conf\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-Dockerfile extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("FROM tiangolo/node-frontend:10 as build-stage\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v('...we also "named" this stage '),e("code",[this._v("build-stage")]),this._v(", with the "),e("code",[this._v("as build-stage")]),this._v(". We will use this name later.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("Our working directory will be "),e("code",[this._v("/app")]),this._v('. This Docker "instruction" will create that directory and go inside of it, all the next steps will "be" in that directory:')])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-Dockerfile extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("WORKDIR /app\n")])])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ul",[n("li",[t._v("Now, this instruction copies all the files that start with "),n("code",[t._v("package")]),t._v(" and end with "),n("code",[t._v(".json")]),t._v(" from your source to inside the container. With the "),n("code",[t._v("package*.json")]),t._v(" it will include the "),n("code",[t._v("package.json")]),t._v(" file and also the "),n("code",[t._v("package-lock.json")]),t._v(" if you have one, but it won't fail if you don't have it. Just that file (or those 2 files), before the rest of the source code, because we want to install everything the first time, but not every time we change our source code. The next time we change our code and build the image, Docker will use the cached \"layers\" with everything installed (because the "),n("code",[t._v("package.json")]),t._v(" hasn't changed) and will only compile our source code:")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-Dockerfile extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("COPY package*.json /app/\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("Install all the dependencies, this will be cached until we change the "),e("code",[this._v("package.json")]),this._v(" file (changing our dependencies). So it won't take very long installing everything every time we iterate in our source code and try to test (or deploy) the production Docker image, just the first time and when we update the dependencies (installed packages):")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-Dockerfile extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("RUN npm install\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("Now, after installing all the dependencies, we can copy our source code. This section will not be cached that much, because we'll be changing our source code constantly, but we already took advantage of Docker caching for all the package install steps in the commands above. So, let's copy our source code:")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-Dockerfile extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("COPY ./ /app/\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v('And here\'s the trick that will allow us to use Angular CLI "configurations" and enable different environments. We create an '),e("code",[this._v("ARG")]),this._v(" that we will pass at "),e("strong",[this._v("build")]),this._v(" time with a default value of "),e("code",[this._v("production")]),this._v(' (the default value for Angular CLI). This will be done at "build time", while building the image, in contrast to at "run time", which is while "running" or starting the image.')])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-Dockerfile extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("ARG configuration=production\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-Dockerfile extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("RUN npm run build -- --output-path=./dist/out --configuration $configuration\n")])])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[t._v("...that will build our app, to the directory "),n("code",[t._v("./dist/out")]),t._v(". Inside the container will be in "),n("code",[t._v("/app/dist/out")]),t._v(". We are specifying the specific "),n("code",[t._v("--output-path=./dist/out")]),t._v(" because otherwise by default Angular CLI would use the name of the project, for example "),n("code",[t._v("./dist/my-angular-project")]),t._v(". But we need to have a specific path to use it later. So, by fixing it to "),n("code",[t._v("./dist/out")]),t._v(" you can copy-paste it directly to your project without worrying about modifying paths in several places.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-Dockerfile extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("FROM nginx:1.15\n")])])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ul",[n("li",[t._v("Here's the Docker multi-stage trick. This is a normal "),n("code",[t._v("COPY")]),t._v(", but it has a "),n("code",[t._v("--from=build-stage")]),t._v(". That "),n("code",[t._v("build-stage")]),t._v(" refers to the name we specified above in the "),n("code",[t._v("as build-stage")]),t._v('. Here, although we are in a Nginx image, starting from scratch, we can copy files from a previous stage. So, we can copy the compiled fresh version of our app. That compiled version is based on the latest source code, and that latest compiled version only lives in the previous Docker "stage", for now. But we\'ll copy it to the Nginx directory, just as static files:')])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-Dockerfile extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("COPY --from=build-stage /app/dist/out/ /usr/share/nginx/html\n")])])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ul",[n("li",[t._v("Now, we'll override the "),n("code",[t._v("default.conf")]),t._v(" file in Nginx with the custom "),n("code",[t._v("nginx.conf")]),t._v(" provided in the image "),n("code",[t._v("tiangolo/node-frontend")]),t._v(". This configuration file directs everything to "),n("code",[t._v("index.html")]),t._v(", so that the Angular router can take care of it's routes:")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-Dockerfile extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("COPY --from=build-stage /nginx.conf /etc/nginx/conf.d/default.conf\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("...that's it for the "),e("code",[this._v("Dockerfile")]),this._v("! Doing that with scripts or any other method would be a lot more cumbersome.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("Optional read")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("If you don't want to use the image "),e("code",[this._v("tiangolo/node-frontend")]),this._v(" but build yours from scratch based on "),e("code",[this._v("node")]),this._v(" you can do it, you just have to create the Nignx config file descriibed in the Nginx section above and modify the line:")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-Dockerfile extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("COPY --from=build-stage /nginx.conf /etc/nginx/conf.d/default.conf\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-Dockerfile extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("COPY ./nginx-custom.conf /etc/nginx/conf.d/default.conf\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("...have in mind that if you don't use "),e("code",[this._v("tiangolo/node-frontend")]),this._v(" you will also have to install Puppeteer and all its dependencies by hand too.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("End optional read")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"build-it"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#build-it","aria-hidden":"true"}},[this._v("#")]),this._v(" Build it")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("If we just build it normally, it will use the production configuration ("),e("code",[this._v("production")]),this._v(") and environment.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("Build your image using the production configuration / environment (the default), e.g.:")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("docker build -t my-angular-project:prod "),e("span",{attrs:{class:"token keyword"}},[this._v(".")]),this._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("But we can build an image for each environment we have, by just passing the configuration name as an argument to the build process. The same as we would pass it to "),e("code",[this._v("ng build --configuration")]),this._v(". We just have to use Docker's "),e("code",[this._v("--build-arg")]),this._v(" parameter.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("Build your image passing an empty string as the "),e("code",[this._v("configuration")]),this._v(" build arg, so that Angular CLI doesn't use a configuration and runs with the development environment, e.g.:")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("docker build -t my-angular-project:dev --build-arg configuration"),e("span",{attrs:{class:"token operator"}},[this._v("=")]),e("span",{attrs:{class:"token string"}},[this._v('""')]),this._v(" "),e("span",{attrs:{class:"token keyword"}},[this._v(".")]),this._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("If you had a "),e("code",[this._v("staging")]),this._v(" configuration and environment, you could build an image for that environment with:")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("docker build -t my-angular-project:dev --build-arg configuration"),e("span",{attrs:{class:"token operator"}},[this._v("=")]),e("span",{attrs:{class:"token string"}},[this._v('"staging"')]),this._v(" "),e("span",{attrs:{class:"token keyword"}},[this._v(".")]),this._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("All these additional builds, and all the next builds (including the "),e("code",[this._v("prod")]),this._v(" one) will be very fast, as all the NPM packages will already be installed and Docker will re-use the cached layers. It will know it just has to copy your source code and compile it, etc. It won't install everything every time. And when you add a new dependency, your "),e("code",[this._v("package.json")]),this._v(" will be modified, Docker will notice it and re-install the dependencies.")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"test-it"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#test-it","aria-hidden":"true"}},[this._v("#")]),this._v(" Test it")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("Test your image for the production environment with:")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("docker run -p 80:80 my-angular-project:prod\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("...notice that it is served by Docker and not by Angular CLI (not in port "),e("code",[this._v("4200")]),this._v('). And notice that it says that you are running the "production" version of your frontend App.')])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("Test your image for the development environment with:")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("docker run -p 80:80 my-angular-project:dev\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("...again, served by Docker and not by Angular CLI (not in port "),e("code",[this._v("4200")]),this._v('). And now you are using your "development" environment version.')])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"add-testing"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#add-testing","aria-hidden":"true"}},[this._v("#")]),this._v(" Add testing")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("Go to your application directory and install Puppeteer:")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{attrs:{class:"token function"}},[this._v("npm")]),this._v(" "),e("span",{attrs:{class:"token function"}},[this._v("install")]),this._v(" puppeteer --save-dev\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("Then install "),e("code",[this._v("karma-chrome-launcher")]),this._v(":")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{attrs:{class:"token function"}},[this._v("npm")]),this._v(" "),e("span",{attrs:{class:"token function"}},[this._v("install")]),this._v(" karma-chrome-launcher --save-dev\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("Modify your "),e("code",[this._v("src/karma.conf.js")]),this._v(" file, add this on the top:")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"language-JavaScript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[t._v("process"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token constant"}},[t._v("CHROME_BIN")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("require")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'puppeteer'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("executablePath")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("Modify your "),e("code",[this._v("src/karma.conf.js")]),this._v(" file, there's a line with:")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"language-JavaScript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[t._v("    browsers"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{attrs:{class:"token string"}},[t._v("'Chrome'")]),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"language-JavaScript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[t._v("    browsers"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{attrs:{class:"token string"}},[t._v("'Chrome'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'ChromeHeadlessNoSandbox'")]),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    captureTimeout"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("210000")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    browserDisconnectTolerance"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("3")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    browserDisconnectTimeout"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("210000")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    browserNoActivityTimeout"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("210000")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    customLaunchers"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      ChromeHeadlessNoSandbox"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        base"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'ChromeHeadless'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        flags"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n          "),n("span",{attrs:{class:"token string"}},[t._v("'--no-sandbox'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),n("span",{attrs:{class:"token comment"}},[t._v("// Without a remote debugging port, Google Chrome exits immediately.")]),t._v("\n          "),n("span",{attrs:{class:"token string"}},[t._v("'--remote-debugging-port=9222'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n      "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("your final "),e("code",[this._v("src/karma.conf.js")]),this._v(" might look like:")])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"language-JavaScript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{attrs:{class:"token comment"}},[t._v("// Karma configuration file, see link for more information")]),t._v("\n"),n("span",{attrs:{class:"token comment"}},[t._v("// https://karma-runner.github.io/1.0/config/configuration-file.html")]),t._v("\n\nprocess"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token constant"}},[t._v("CHROME_BIN")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("require")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'puppeteer'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("executablePath")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nmodule"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("config"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  config"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token keyword"}},[t._v("set")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    basePath"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("''")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    frameworks"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{attrs:{class:"token string"}},[t._v("'jasmine'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'@angular-devkit/build-angular'")]),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    plugins"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),n("span",{attrs:{class:"token function"}},[t._v("require")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'karma-jasmine'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),n("span",{attrs:{class:"token function"}},[t._v("require")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'karma-chrome-launcher'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),n("span",{attrs:{class:"token function"}},[t._v("require")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'karma-jasmine-html-reporter'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),n("span",{attrs:{class:"token function"}},[t._v("require")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'karma-coverage-istanbul-reporter'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),n("span",{attrs:{class:"token function"}},[t._v("require")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'@angular-devkit/build-angular/plugins/karma'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    client"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      clearContext"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token boolean"}},[t._v("false")]),t._v(" "),n("span",{attrs:{class:"token comment"}},[t._v("// leave Jasmine Spec Runner output visible in browser")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    coverageIstanbulReporter"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      dir"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("require")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'path'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("join")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'../coverage'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      reports"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{attrs:{class:"token string"}},[t._v("'html'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'lcovonly'")]),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      fixWebpackSourcePaths"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    reporters"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{attrs:{class:"token string"}},[t._v("'progress'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'kjhtml'")]),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    port"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("9876")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    colors"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token boolean"}},[t._v("true")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    logLevel"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" config"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token constant"}},[t._v("LOG_INFO")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    autoWatch"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token boolean"}},[t._v("true")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    browsers"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{attrs:{class:"token string"}},[t._v("'Chrome'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'ChromeHeadlessNoSandbox'")]),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    captureTimeout"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("210000")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    browserDisconnectTolerance"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("3")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    browserDisconnectTimeout"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("210000")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    browserNoActivityTimeout"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("210000")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    customLaunchers"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      ChromeHeadlessNoSandbox"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        base"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'ChromeHeadless'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        flags"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n          "),n("span",{attrs:{class:"token string"}},[t._v("'--no-sandbox'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),n("span",{attrs:{class:"token comment"}},[t._v("// Without a remote debugging port, Google Chrome exits immediately.")]),t._v("\n          "),n("span",{attrs:{class:"token string"}},[t._v("'--remote-debugging-port=9222'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n      "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    singleRun"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("Normally you would test your app with:")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("ng "),e("span",{attrs:{class:"token function"}},[this._v("test")]),this._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("Note")]),this._v(": as of now, 2018-06-29, a new, freshly generated Angular CLI project will fail 1 test, looking for a string "),e("code",[this._v("'Welcome to my-frontend-project!'")]),this._v(", you can change the string to "),e("code",[this._v("'Welcome to app!'")]),this._v(" to fix the test.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[e("p",[this._v('In a Docker container, in your "integration" or "production" server, the tests will run in Chrome headless. So, let\'s first make sure that Chrome headless runs locally.')])]),this._v(" "),e("li",[e("p",[this._v("Run a "),e("em",[this._v("single")]),this._v(' (not "watch") test locally, in headless mode:')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("ng "),e("span",{attrs:{class:"token function"}},[this._v("test")]),this._v(" --browsers ChromeHeadlessNoSandbox --watch"),e("span",{attrs:{class:"token operator"}},[this._v("=")]),this._v("false\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("Optional read")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("If you don't want to use "),e("code",[this._v("tiangolo/node-frontend")]),this._v(" you will have to install Puppeteer and it's dependencies by hand, here's how.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-Dockerfile extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("FROM node:10.5 as build-stage\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-Dockerfile extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('# Stage 0, "build-stage", based on Node.js, to build and compile Angular\nFROM node:10.5 as build-stage\n\n# See https://crbug.com/795759\nRUN apt-get update && apt-get install -yq libgconf-2-4\n\n# Install latest chrome dev package and fonts to support major charsets (Chinese, Japanese, Arabic, Hebrew, Thai and a few others)\n# Note: this installs the necessary libs to make the bundled version of Chromium that Puppeteer\n# installs, work.\nRUN apt-get update && apt-get install -y wget --no-install-recommends \\\n    && wget -q -O - https://dl-ssl.google.com/linux/linux_signing_key.pub | apt-key add - \\\n    && sh -c \'echo "deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main" >> /etc/apt/sources.list.d/google.list\' \\\n    && apt-get update \\\n    && apt-get install -y google-chrome-unstable fonts-ipafont-gothic fonts-wqy-zenhei fonts-thai-tlwg fonts-kacst ttf-freefont \\\n      --no-install-recommends \\\n    && rm -rf /var/lib/apt/lists/* \\\n    && apt-get purge --auto-remove -y curl \\\n    && rm -rf /src/*.deb\n\n...\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("End optional read")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("Then you can run your tests, after the section with:")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-Dockerfile extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("COPY ./ /app/\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-Dockerfile extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("RUN npm run test -- --browsers ChromeHeadlessNoSandbox --watch=false\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Your final "),e("code",[this._v("Dockerfile")]),this._v(" would look like:")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-Dockerfile extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('# Stage 0, "build-stage", based on Node.js, to build and compile the frontend\nFROM tiangolo/node-frontend:10 as build-stage\n\nWORKDIR /app\n\nCOPY package*.json /app/\n\nRUN npm install\n\nCOPY ./ /app/\n\nRUN npm run test -- --browsers ChromeHeadlessNoSandbox --watch=false\n\nARG configuration=production\n\nRUN npm run build -- --output-path=./dist/out --configuration $configuration\n\n\n# Stage 1, based on Nginx, to have only the compiled app, ready for production with Nginx\nFROM nginx:1.15\n\nCOPY --from=build-stage /app/dist/out/ /usr/share/nginx/html\n\n# Copy the default nginx.conf provided by tiangolo/node-frontend\nCOPY --from=build-stage /nginx.conf /etc/nginx/conf.d/default.conf\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("Optional read")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("If you didn't use the image "),e("code",[this._v("tiangolo/node-frontend")]),this._v(" your final complete "),e("code",[this._v("Dockerfile")]),this._v(" would look something like:")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-Dockerfile extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('# Stage 0, "build-stage", based on Node.js, to build and compile Angular\nFROM node:10.5 as build-stage\n\n# See https://crbug.com/795759\nRUN apt-get update && apt-get install -yq libgconf-2-4\n\n# Install latest chrome dev package and fonts to support major charsets (Chinese, Japanese, Arabic, Hebrew, Thai and a few others)\n# Note: this installs the necessary libs to make the bundled version of Chromium that Puppeteer\n# installs, work.\nRUN apt-get update && apt-get install -y wget --no-install-recommends \\\n    && wget -q -O - https://dl-ssl.google.com/linux/linux_signing_key.pub | apt-key add - \\\n    && sh -c \'echo "deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main" >> /etc/apt/sources.list.d/google.list\' \\\n    && apt-get update \\\n    && apt-get install -y google-chrome-unstable fonts-ipafont-gothic fonts-wqy-zenhei fonts-thai-tlwg fonts-kacst ttf-freefont \\\n      --no-install-recommends \\\n    && rm -rf /var/lib/apt/lists/* \\\n    && apt-get purge --auto-remove -y curl \\\n    && rm -rf /src/*.deb\n\nWORKDIR /app\n\nCOPY package*.json /app/\n\nRUN npm install\n\nCOPY ./ /app/\n\nRUN npm run test -- --browsers ChromeHeadlessNoSandbox --watch=false\n\nARG configuration=production\n\nRUN npm run build -- --output-path=./dist/out --configuration $configuration\n\n\n# Stage 1, based on Nginx, to have only the compiled app, ready for production with Nginx\nFROM nginx:1.15\n\nCOPY --from=build-stage /app/dist/out/ /usr/share/nginx/html\n\nCOPY ./nginx-custom.conf /etc/nginx/conf.d/default.conf\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("End optional read")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("To test that your new Docker image with tests works, just build it again, you should see the results in the console. Check the section above ...or just run:")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("docker build -t my-angular-project:prod "),e("span",{attrs:{class:"token keyword"}},[this._v(".")]),this._v("\n")])])])}],!1,null,null,null);s.options.__file="dockerize-angular.md";e.default=s.exports}}]);